import{c$ as B,r,c as g,w as F,o as z,dm as E,h as i,dj as I,dS as O,ee as j,dP as H,g as L,dt as U,e1 as V,dq as D}from"./index.d880ed97.js";import{T as G}from"./TouchPan.3b569cbf.js";import{b as Y}from"./format.7f0b6061.js";const n=40,T=20;var K=B({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:{default:void 0}},emits:["refresh"],setup(l,{slots:_,emit:b}){const{proxy:m}=L(),{$q:C}=m,t=r("pull"),c=r(0),o=r(!1),f=r(-n),v=r(!1),S=r({}),P=g(()=>({opacity:c.value,transform:`translateY(${f.value}px) rotate(${c.value*360}deg)`})),y=g(()=>"q-pull-to-refresh__puller row flex-center"+(v.value===!0?" q-pull-to-refresh__puller--animating":"")+(l.bgColor!==void 0?` bg-${l.bgColor}`:""));function $(e){if(e.isFinal===!0){o.value===!0&&(o.value=!1,t.value==="pulled"?(t.value="refreshing",p({pos:T}),w()):t.value==="pull"&&p({pos:-n,ratio:0}));return}if(v.value===!0||t.value==="refreshing")return!1;if(e.isFirst===!0){if(U(x)!==0||e.direction!=="down")return o.value===!0&&(o.value=!1,t.value="pull",p({pos:-n,ratio:0})),!1;o.value=!0;const{top:M,left:Q}=d.getBoundingClientRect();S.value={top:M+"px",left:Q+"px",width:window.getComputedStyle(d).getPropertyValue("width")}}V(e.evt);const s=Math.min(140,Math.max(0,e.distance.y));f.value=s-n,c.value=Y(s/(T+n),0,1);const u=f.value>T?"pulled":"pull";t.value!==u&&(t.value=u)}const q=g(()=>{const e={down:!0};return l.noMouse!==!0&&(e.mouse=!0),[[G,$,void 0,e]]}),R=g(()=>`q-pull-to-refresh__content${o.value===!0?" no-pointer-events":""}`);function w(){b("refresh",()=>{p({pos:-n,ratio:0},()=>{t.value="pull"})})}let d,x,a=null;function p({pos:e,ratio:s},u){v.value=!0,f.value=e,s!==void 0&&(c.value=s),a!==null&&clearTimeout(a),a=setTimeout(()=>{a=null,v.value=!1,u&&u()},300)}function h(){x=D(d,l.scrollTarget)}return F(()=>l.scrollTarget,h),z(()=>{d=m.$el,h()}),E(()=>{a!==null&&clearTimeout(a)}),Object.assign(m,{trigger:w,updateScrollTarget:h}),()=>{const e=[i("div",{class:R.value},I(_.default)),i("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:S.value},[i("div",{class:y.value,style:P.value},[t.value!=="refreshing"?i(O,{name:l.icon||C.iconSet.pullToRefresh.icon,color:l.color,size:"32px"}):i(j,{size:"24px",color:l.color})])])];return H("div",{class:"q-pull-to-refresh"},e,"main",l.disable===!1,()=>q.value)}}});export{K as Q};
