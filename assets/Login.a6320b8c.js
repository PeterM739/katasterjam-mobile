import{Q as L,a as C,b as x,c as S,d as T}from"./QLayout.3ef70874.js";import{h as o,c$ as Q,d0 as P,d1 as k,d2 as V,d3 as N,d4 as F,d5 as q,d6 as H,r as p,d7 as g,d8 as I,c as M,cM as f,d9 as b,da as a,d as s,db as v,dc as l,dd as u,de as $,df as m,dg as w,dh as z,di as B,cV as D}from"./index.d880ed97.js";import{Q as A,a as E,b as O,c as R}from"./QPage.afe2ab63.js";import{u as U}from"./use-quasar.fff60b60.js";import"./QResizeObserver.b8f563d0.js";const j=[o("g",[o("path",{fill:"none",stroke:"currentColor","stroke-width":"5","stroke-miterlimit":"10",d:"M58.4,51.7c-0.9-0.9-1.4-2-1.4-2.3s0.5-0.4,1.4-1.4 C70.8,43.8,79.8,30.5,80,15.5H70H30H20c0.2,15,9.2,28.1,21.6,32.3c0.9,0.9,1.4,1.2,1.4,1.5s-0.5,1.6-1.4,2.5 C29.2,56.1,20.2,69.5,20,85.5h10h40h10C79.8,69.5,70.8,55.9,58.4,51.7z"}),o("clipPath",{id:"uil-hourglass-clip1"},[o("rect",{x:"15",y:"20",width:"70",height:"25"},[o("animate",{attributeName:"height",from:"25",to:"0",dur:"1s",repeatCount:"indefinite",values:"25;0;0",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"20",to:"45",dur:"1s",repeatCount:"indefinite",values:"20;45;45",keyTimes:"0;0.5;1"})])]),o("clipPath",{id:"uil-hourglass-clip2"},[o("rect",{x:"15",y:"55",width:"70",height:"25"},[o("animate",{attributeName:"height",from:"0",to:"25",dur:"1s",repeatCount:"indefinite",values:"0;25;25",keyTimes:"0;0.5;1"}),o("animate",{attributeName:"y",from:"80",to:"55",dur:"1s",repeatCount:"indefinite",values:"80;55;55",keyTimes:"0;0.5;1"})])]),o("path",{d:"M29,23c3.1,11.4,11.3,19.5,21,19.5S67.9,34.4,71,23H29z","clip-path":"url(#uil-hourglass-clip1)",fill:"currentColor"}),o("path",{d:"M71.6,78c-3-11.6-11.5-20-21.5-20s-18.5,8.4-21.5,20H71.6z","clip-path":"url(#uil-hourglass-clip2)",fill:"currentColor"}),o("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"180 50 50",repeatCount:"indefinite",dur:"1s",values:"0 50 50;0 50 50;180 50 50",keyTimes:"0;0.7;1"})])];var J=Q({name:"QSpinnerHourglass",props:P,setup(e){const{cSize:t,classes:c}=k(e);return()=>o("svg",{class:c.value,width:t.value,height:t.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},j)}});const K={name:"LoginPage",setup(){const e=N(),t=F(),c=q(),r=H(),i=p(0),{getPageNumber:d}=g(t),{getPageNumber:n}=g(r),h=I(),{getPageNumber:y}=g(h),{notify:_}=U();return{notify:_,loggingIn:p(!1),store:e,cavesStore:t,excursionsStore:h,progress:i,progressLabel:M(()=>(i.value*100).toFixed(2)+"%"),mapStore:c,getPageNumber:d,customLocations:r,customLocationPage:n,excursionsPage:y}},data(){return{account:{email:"",password:""},progressLabelTitle:this.$t("fetchingCaveData")}},watch:{getPageNumber(e,t){this.progress=e/this.cavesStore.totalPages},customLocationPage(e,t){this.progress=e/this.customLocations.getTotalPages},excursionsPage(e,t){this.progress=e/this.excursionsStore.getTotalPages}},methods:{async submitForm(){this.loggingIn=!0;try{const e={email:this.account.email,password:this.account.password,rememberMe:!0},t=await this.store.login(e);await this.mapStore.fetchMapCapabilities(),t.success?(await this.cavesStore.tryFetchCavesForOffline(),this.progress=0,this.progressLabelTitle=this.$t("fetchingCustomLocationData"),await this.customLocations.tryFetchCustomLocationsForOffline(),this.progressLabelTitle=this.$t("fetchingCustomLocationTypes"),await this.customLocations.fetchCustomLocationsTypes(),this.progressLabelTitle=this.$t("fetchingCustomLocationStatuses"),await this.customLocations.fetchCustomLocationsStatuses(),this.progress=0,this.progressLabelTitle=this.$t("fetchingExcursionsData"),await this.excursionsStore.tryFetchExcursionsForOffline(),this.$router.replace("/")):console.error(t.message[0])}catch(e){console.error(e),this.notify({message:this.$t("loginFailed"),color:"red"})}finally{this.loggingIn=!1}}}},Y={class:"column"},G={class:"row"},W={class:"text-h5 text-white q-my-md"},X={class:"row"},Z={class:"text-grey-6"},ee={class:"text-grey-6"},te={class:"absolute-full flex flex-center"};function se(e,t,c,r,i,d){return f(),b(L,{view:"lHh Lpr lFf"},{default:a(()=>[s(S,{elevated:""},{default:a(()=>[s(C,null,{default:a(()=>[s(x,null,{default:a(()=>[v(" eKatasterJam ")]),_:1})]),_:1})]),_:1}),s(T,null,{default:a(()=>[s(A,{class:"bg-light-blue row justify-center items-center"},{default:a(()=>[l("div",Y,[l("div",G,[l("h5",W,u(e.$t("logIn")),1)]),l("div",X,[s($,{bordered:"",class:"q-pa-lg shadow-1"},{default:a(()=>[s(m,null,{default:a(()=>[s(E,{class:"q-gutter-md"},{default:a(()=>[s(w,{square:"",filled:"",clearable:"",modelValue:i.account.email,"onUpdate:modelValue":t[0]||(t[0]=n=>i.account.email=n),type:"email",label:e.$t("email")},null,8,["modelValue","label"]),s(w,{square:"",filled:"",clearable:"",modelValue:i.account.password,"onUpdate:modelValue":t[1]||(t[1]=n=>i.account.password=n),type:"password",label:e.$t("password")},null,8,["modelValue","label"])]),_:1})]),_:1}),s(z,{class:"q-px-md"},{default:a(()=>[s(B,{disable:r.loggingIn,loading:r.loggingIn,unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loginLabel"),onClick:d.submitForm,type:"submit"},{loading:a(()=>[s(J,{class:"on-right"}),v(" "+u(e.$t("loggingIn")),1)]),_:1},8,["disable","loading","label","onClick"])]),_:1}),s(m,{class:"text-center q-pa-none"},{default:a(()=>[l("p",Z,u(e.$t("register")),1)]),_:1}),r.loggingIn?(f(),b(m,{key:0,class:"text-center q-pa-none"},{default:a(()=>[l("p",ee,u(i.progressLabelTitle),1),s(O,{"instant-feedback":!0,size:"50px",value:r.progress,color:"accent",class:"q-mt-sm"},{default:a(()=>[l("div",te,[s(R,{color:"white","text-color":"accent",label:r.progressLabel},null,8,["label"])])]),_:1},8,["value"])]),_:1})):D("",!0)]),_:1})])])]),_:1})]),_:1})]),_:1})}var ne=V(K,[["render",se]]);export{ne as default};
