import{d2 as v,d5 as k,r,dR as c,cM as f,d9 as w,eL as R,eM as T,d7 as U,cN as g,d as i,da as h,F as b,ea as V}from"./index.d880ed97.js";import{o as C,W as j,M}from"./WMTS.c1c6dbd5.js";const O={props:{layer:Object},setup(){const t=k();return{layerRef:r(null),mapStore:t}},async mounted(){await(async(e,a)=>{const o=localStorage.getItem(`cap-${e.label}`),n=JSON.parse(o.replace(/http:\/\//g,"https://")),l=C(n,{layer:e.layerName}),s={projection:e.projection,...l,attributions:[e.attributes],crossOrigin:"anonymous"};s.tileLoadFunction=async(_,m)=>{const y=_.getImage(),p=await R.tiles.where("tileKey").equals(m).first();if(!p){T.getTileImage(_,m,!0);return}const d=URL.createObjectURL(p.image);y.onload=function(){URL.revokeObjectURL(d)},y.src=d};const u=new j(s);this.mapStore.setSource(e,u),a.tileLayer.setVisible(this.layer.active),a.tileLayer.setSource(u)})(this.layer,this.layerRef)},watch:{layer:{deep:!0,handler:function(t,e){this.layerRef.tileLayer.setVisible(t.active)}}}};function F(t,e,a,o,n,l){const s=c("ol-tile-layer");return f(),w(s,{ref:"layerRef"},null,512)}var W=v(O,[["render",F]]);const $={components:{CustomWMTSLayer:W},setup(){const t=k(),e=r(null),a=r(null),o=r(null),n=r(null),l=new M,s=r(5),u=r(.5),_=r("black"),m=r("rgba(255, 50, 28, 0.6)"),y=r([]),{isSkyViewActive:p,isOrthoPhotoActive:d,getOrthoPhoto:L}=U(t);return{skyViewLayer:e,orthoPhotoLayer:a,isSkyViewActive:p,isOrthoPhotoActive:d,mapStore:t,getOrthoPhoto:L,osmSource:n,cavesSource:o,mvtFormat:l,radius:s,strokeWidth:u,stroke:_,fill:m,highlightedFeatures:y}},watch:{isSkyViewActive(t,e){this.skyViewLayer.tileLayer.setVisible(t)}},async mounted(){var t;(t=this.osmSource.source)==null||t.setTileLoadFunction(async(e,a)=>{const o=e.getImage(),n=a.replace(/^(https?:\/\/)[abc]\./,"$1"),l=await R.tiles.where("tileKey").equals(n).first();if(!l){T.getTileImage(e,a);return}const s=URL.createObjectURL(l.image);o.onload=function(){URL.revokeObjectURL(s)},o.src=s}),this.mapStore.getCavesLayerSource().then(e=>{this.cavesSource.vectorLayer.setSource(e)})}};function x(t,e,a,o,n,l){const s=c("ol-source-osm"),u=c("ol-tile-layer"),_=c("CustomWMTSLayer"),m=c("ol-style-fill"),y=c("ol-style-stroke"),p=c("ol-style-circle"),d=c("ol-style"),L=c("ol-vector-layer");return f(),g(b,null,[i(u,null,{default:h(()=>[i(s,{ref:"osmSource"},null,512)]),_:1}),(f(!0),g(b,null,V(o.mapStore.getLayers,S=>(f(),w(_,{key:S.name,layer:S},null,8,["layer"]))),128)),i(L,{ref:"cavesSource"},{default:h(()=>[i(d,null,{default:h(()=>[i(p,{radius:o.radius},{default:h(()=>[i(m,{color:o.fill},null,8,["color"]),i(y,{color:o.stroke,width:o.strokeWidth},null,8,["color","width"])]),_:1},8,["radius"])]),_:1})]),_:1},512)],64)}var A=v($,[["render",x]]);export{A as C};
