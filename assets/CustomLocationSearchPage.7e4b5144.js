import{d2 as _,d6 as w,r as h,eQ as P,dR as N,cM as l,cN as m,d as t,da as o,dg as v,di as k,F as Q,d9 as y,dS as c,ea as q,eN as z,cV as L,db as f,dd as i,eO as $,eP as M}from"./index.d880ed97.js";import{a as O,c as C,Q as g}from"./format.7f0b6061.js";import{Q as F}from"./QSlideItem.a47d2873.js";import{Q as I}from"./TouchPan.3b569cbf.js";import{Q as T}from"./QPullToRefresh.d3168b8d.js";import{u as V}from"./use-quasar.fff60b60.js";import{O as D}from"./OrganizationsList.a1963a43.js";const R={name:"CustomLocationSearchPage",components:{OrganizationsList:D},setup(){const{dialog:e}=V(),a=w();a.uploadNew().then(()=>{console.log("Possible offline data uploaded"),a.tryFetchCustomLocationsForOffline().then(()=>{console.log("Custom location list updated")})}),a.search().then(()=>{console.log("custom locations loaded")});const u=h(a.getQuery),n=h(null),d=h(null);return{confirmDialog:e,store:a,query:u,confirm:h(!1),selectedCustomLocation:n,closeSlider:null,confirmRef:d,formatDate:P}},computed:{customLocations(){return this.store.getCustomLocations},pageNumber(){return this.store.getPageNumber},totalPages(){return this.store.getTotalPages},currentSort(){return this.store.getCurrentSort},selectedName(){var e,a;return`[${(e=this.selectedCustomLocation)==null?void 0:e.id}] ${(a=this.selectedCustomLocation)==null?void 0:a.name}`},searching(){return this.store.getSearchingStatus}},watch:{query(e,a){this.executeSearch()}},methods:{goTo({reset:e},a){var n,d;e(),this.selectedCustomLocation=a;const u=`[${(n=this.selectedCustomLocation)==null?void 0:n.id}] ${(d=this.selectedCustomLocation)==null?void 0:d.name}`;this.confirmDialog({title:`${this.$t("confirm")}`,message:`${this.$t("navigateToCustomLocation")}: ${u}`,cancel:!0,persistent:!0}).onOk(()=>{this.$router.push({path:"/",query:{lat:this.selectedCustomLocation.lat,lng:this.selectedCustomLocation.lng,navigate:!0,customLocation:!0,name:u}})})},customLocationClick(e){this.$router.push({name:"custom-locations-details",params:{id:e}})},showOnMapClick(e){this.$router.push({path:"/",query:{lat:e.lat,lng:e.lng,customLocation:!0}})},async loadMore(){this.store.incrementPageNumber(),await this.store.search()},async executeSearch(){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search()},async searchAroundMe(){if(this.currentSort){this.store.clearLocationParameters(),this.store.addQueryParameter(this.query),await this.store.search();return}await this.store.searchForNearby()},async refresh(e){this.currentSort==="distance"?await this.store.searchForNearby():await this.store.search(),e()}}},A={key:0};function B(e,a,u,n,d,s){const b=N("OrganizationsList");return l(),m(Q,null,[t(v,{loading:s.searching,modelValue:n.query,"onUpdate:modelValue":a[1]||(a[1]=r=>n.query=r),debounce:"500",filled:"",placeholder:e.$t("search"),hint:e.$t("searchForCustomLocation")},{append:o(()=>[n.query!==""?(l(),y(c,{key:0,name:"close",onClick:a[0]||(a[0]=r=>n.query=""),class:"cursor-pointer"})):(l(),y(c,{key:1,name:"search"}))]),after:o(()=>[t(k,{round:"",dense:"",flat:"",icon:"gps_fixed",onClick:s.searchAroundMe,color:s.currentSort==="distance"?"light-green":""},null,8,["onClick","color"])]),_:1},8,["loading","modelValue","placeholder","hint"]),t(T,{onRefresh:s.refresh},{default:o(()=>[t(I,{ref:"scrollTargetRef",class:"scroll"},{default:o(()=>[(l(!0),m(Q,null,q(s.customLocations,(r,S)=>(l(),m("div",{key:S},[t(F,{onLeft:p=>s.goTo(p,r)},{left:o(()=>[t(c,{name:"assist_walker"})]),default:o(()=>[t(O,{clickable:"",onClick:p=>s.customLocationClick(r.id)},{default:o(()=>[t(C,{avatar:"",top:""},{default:o(()=>[t(z,{icon:"info",color:"primary","text-color":"white"}),t(c,{name:"keyboard_double_arrow_right",size:"lg",color:"primary"})]),_:1}),t(C,null,{default:o(()=>[t(g,{lines:"1"},{default:o(()=>[r.isAuthor?(l(),m("span",A,[t(c,{name:"check"})])):L("",!0),f(" "+i(r.id)+" - "+i(r.name),1)]),_:2},1024),t(g,{caption:""},{default:o(()=>[f(i(e.$t("type"))+": "+i(r.type)+", "+i(e.$t("date"))+": "+i(n.formatDate(r.createdDate)),1)]),_:2},1024),t(g,{caption:""},{default:o(()=>[f(i(e.$t("organizations"))+": ",1),t(b,{organizations:r.organizations},null,8,["organizations"])]),_:2},1024),r.distance?(l(),y(g,{key:0,caption:""},{default:o(()=>[f(i(e.$t("distance"))+": "+i(parseInt(r.distance))+" m",1)]),_:2},1024)):L("",!0)]),_:2},1024),t(C,{side:""},{default:o(()=>[t(c,{name:"map",color:"green",size:"lg",onClick:$(p=>s.showOnMapClick(r),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["onLeft"]),t(M)]))),128))]),_:1},512)]),_:1},8,["onRefresh"]),t(k,{unelevated:"",color:"light-blue-7",size:"lg",class:"full-width",label:e.$t("loadMore"),onClick:s.loadMore,disabled:s.totalPages<=s.pageNumber},null,8,["label","onClick","disabled"])],64)}var K=_(R,[["render",B]]);export{K as default};
